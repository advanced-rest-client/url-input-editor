<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../../@webcomponents/webcomponentsjs/webcomponents-loader.js"></script>
    <script src="../../../@polymer/test-fixture/test-fixture.js"></script>
    <script src="../../../mocha/mocha.js"></script>
    <script src="../../../chai/chai.js"></script>
    <script src="../../../wct-mocha/wct-mocha.js"></script>

  </head>
  <body>

    <test-fixture id="basic">
      <template>
        <url-input-editor value="http://ux.mulesoft.com/path?param=value"></url-input-editor>
      </template>
    </test-fixture>

    <script type="module">
    import '../url-input-editor.js';
    import MockInteractions from '../../../@polymer/iron-test-helpers/mock-interactions.js';
    import sinon from '../../../sinon/pkg/sinon-esm.js';

    suite('events tests', function() {
      let element;
      setup(function() {
        element = fixture('basic');
      });

      test('Dispatches "send-request" custom event on main field', function(done) {
        const spy = sinon.stub();
        element.addEventListener('send-request', spy);
        flush(() => {
          const input = element.shadowRoot.querySelector('.main-input');
          MockInteractions.pressEnter(input.inputElement.inputElement);
          assert.isTrue(spy.calledOnce, 'Fired send-request event');
          done();
        });
      });

      test('Fires "url-value-changed" custom event', function(done) {
        flush(() => {
          const spy = sinon.stub();
          element.addEventListener('url-value-changed', spy);
          element.detailsOpened = true;
          const details = element.shadowRoot.querySelector('url-detailed-editor');
          details.set('model.host', 'https://test-com/');
          assert.isTrue(spy.calledOnce, 'Fired url-value-changed event');
          done();
        });
      });

      test('"url-value-changed" contains all properties', function(done) {
        flush(() => {
          element.addEventListener('url-value-changed', function clb(e) {
            element.removeEventListener('url-value-changed', clb);
            assert.equal(e.detail.value, 'https://test.com/path?param=value');
            assert.lengthOf(e.detail.queryParameters, 1);
            done();
          });
          element.detailsOpened = true;
          const details = element.shadowRoot.querySelector('url-detailed-editor');
          details.set('model.host', 'https://test.com');
        });
      });
    });
    </script>

  </body>
</html>
